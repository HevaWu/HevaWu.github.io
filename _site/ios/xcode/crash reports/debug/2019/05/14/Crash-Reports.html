<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Heva Wu's Blog - Crash Reports</title>
    <meta name="viewport" content="width=device-width">

    <!-- syntax highlighting CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/main.css">

    <!-- Responsive CSS -->
    <link rel="stylesheet" href="/css/responsive.css">

    <!-- Google Fonts -->
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Raleway:300,400,700' rel='stylesheet' type='text/css'>
</head>

<body>
  <div class="site">
    <div class="sidebar" id="sidebar">
      <div class="header">
        <h1 class="title"><a href="/about" ><img id="logo" src="/images/logo.png"></a></h1>
        <span class="tagline">Heva Wu's Blog</span>
        <span class="motto">I may not be there yet, but I'm closer than I was yesterday. </span>
        <span class="motto">(￣︶￣)↗[GO!]</span>
      </div>
      <div class="sidebar-info">
        <ul class="sidebar-info-list">
          <li class="sidebar-info-link">
              <a href="/blog/tags" class="">Tags</a>
          </li>
          <li>
              <a href="/blog/categories" class="">Categories</a>
          </li>
          <li>
              <a href="/blog.html" class="footer-link">Latest Blog</a>
          </li>
        </ul>
      </div>
      <div class="footer">
        <span id="footer-links">
          <a href="/about" class="footer-link">About</a> <span class="separator">&bull;</span>
          <a href="https://www.linkedin.com/in/he-heva-wu-2a6819113/" class="footer-link">LinkedIn</a> <span class="separator">&bull;</span>
          <a href="https://github.com/HevaWu" class="footer-link">GitHub</a>
        </span>
      </div>
    </div>

    <div class="content" id="home">
  <div id="sidebar-button">
    <img src="/images/sidebar-button.png">
  </div>

  <div id="post-info">
    <div id="cover-photo-container">
      
    </div>
    <div id="info-container">
      <h1 id="title">Crash Reports</h1>
      <time datetime="2019-05-14T01:04:00+09:00" itemprop="datePublished">
        May 14, 2019
      </time>
      <div id="tag-category-container">
           
          
          <a href="/blog/tags/#ios" class="post-tag">iOS</a>
          
          <a href="/blog/tags/#xcode" class="post-tag">XCode</a>
          
          <a href="/blog/tags/#crash-reports" class="post-tag">Crash Reports</a>
          
          <a href="/blog/tags/#debug" class="post-tag">Debug</a>
          
          
          <p></p>
           
          
          <a href="/blog/categories/#ios" class="post-category">iOS</a>
          
          <a href="/blog/categories/#xcode" class="post-category">XCode</a>
          
          <a href="/blog/categories/#crash-reports" class="post-category">Crash Reports</a>
          
          <a href="/blog/categories/#debug" class="post-category">Debug</a>
          
          
      </div>
    </div>
  </div>

  <div class="post">
    <p>As an app developer, not only deploy the product, we also need to be able to analyze the crash log. And find a way to fix the crashes.</p>

<p>When an application crashed, a <code class="highlighter-rouge">crash report</code> is created and stored on the device. This article is simple introduce the crash reports contents and the analytic method.</p>

<h1 id="symbolicating-crash-reports">Symbolicating Crash Reports</h1>
<p>Crash reports with backtraces need to be <code class="highlighter-rouge">symbolicated</code> before being anlyzed. Symbolication replacec memory addresses with human-readable function names and line numbers.</p>

<h2 id="symbolicating-process">Symbolicating Process</h2>
<ol>
  <li>Compiler translates the source code, it also generates debug symbols (which map each machine instruction in the comipled binary back to the line of source code from which it originated) – Depending on the <code class="highlighter-rouge">Debug Information Format</code> build settings. These debug symbols are stored inside the binary or in a companion Debug Symbol(<code class="highlighter-rouge">dSYM</code>) file. By default, debug builds of an application store the debug symbols inside the compiled binary while release builds of an application store the debug symbols in a companion dSYM file to reduce the binary size. The Debug Symbol file and application binary are tied together on a per-build-basis by the build UUID. A new UUID is generated for each build of your application and uniquely identifies that build. Even if a functionally-identical executable is rebuilt from the same source code, with the same compiler settings, it will have a different build UUID. Debug Symbol files from subsequent builds, even from the same source files, will not interoperate with binaries from other builds.</li>
  <li>During archive, Xcode will gather the application binary along with the .dSYM file and store them at a location inside your home folder. You can find all of your archived applications in the Xcode Organizer under the “Archived” section.
    <ul>
      <li>NOTE: To symbolicate crash reports from testers, app review, and customers, you must retain th archive for each build of the application that you distribute.</li>
    </ul>
  </li>
  <li>Distributing: if you are distributing your app via the App Store, or conducting a beta test using Test Flight, you will be given the option of including the <code class="highlighter-rouge">dSYM</code> file when uploading your archive to iTunes Connect. In the submission dialog, check “Include app symbols for your application…”. Uploading your <code class="highlighter-rouge">dSYM</code> file is necessary to receive crash reports collected from TestFlight users and customers who have opted to share diagnostic data.</li>
  <li>When your application crashes, an unsymbolicated crash report is created and stored on the device.</li>
  <li>Users can retrieve crash reports directly from their device by following the steps in Debugging Deployed iOS Apps. If you have distributed your application via AdHoc or Enterprise distribution, this is the only way to acquire crash reports from your users.</li>
  <li>Crash reports retrieved from a device are unsymbolicated and will need to be symbolicated using Xcode. Xcode uses the dSYM file associated with your application binary to replace each address in the backtrace with its originating location in your source code. The result is a symbolicated crash report.</li>
  <li>If the user has opted to share diagnostic data with Apple, or if the user has installed a beta version of your application through TestFlight, the crash report is uploaded to the App Store.</li>
  <li>The App Store symbolicates the crash report and groups it with similar crash reports. This aggregate of similar crash reports is called a Crash Point.</li>
  <li>The symbolicated crash reports are made available to you in Xcode’s Crashes organizer.</li>
</ol>

<h2 id="getting-dsym-files">Getting dSYM files</h2>

<h3 id="downloading-the-dsym-files-from-xcode">Downloading the dSYM files from Xcode</h3>
<ol>
  <li>In the Archives organizer, select the archive that you originally submitted to the App Store.</li>
  <li>Click the Download dSYMs button.</li>
</ol>

<h3 id="downloading-the-dsym-files-from-the-itunes-connect-website">Downloading the dSYM files from the iTunes Connect website</h3>
<ol>
  <li>Open the App Details page.</li>
  <li>Click Activity.</li>
  <li>From the list of All Builds, select a version.</li>
  <li>Click the Download dSYM link.</li>
</ol>

<h3 id="translating-symbol-names-back-to-original-names">Translating symbol names back to original names</h3>
<p>When you upload your app with bitcode to the App Store, you may choose not to
send your application’s symbols by unchecking the “Upload your app’s symbols to
receive symbolicated reports from Apple” box in the submission dialog.
If you choose not to send your app’s symbol information to Apple, Xcode will
replace the symbols in your app’s .dSYM files with obfuscated symbols such as
“<em>_hidden#109</em>” before sending your app to iTunes Connect. Xcode creates a
mapping between the original symbols and the “hidden” symbols and stores this
mapping in a .bcsymbolmap file inside the application archive. Each .dSYM file
will have a corresponding .bcsymbolmap file.</p>

<p>Before symbolicating crash reports, you will need to de-obfuscate the symbols in
the <code class="highlighter-rouge">.dSYM</code> files downloaded from iTunes Connect.
If you use the Download dSYMs button in Xcode, this de-obfuscation will be
performed automatically for you.
However, if you use the iTunes Connect website to download the <code class="highlighter-rouge">.dSYM</code> files, open Terminal and use the following command to de-obfuscate your symbols
(replacing the example paths with your own archive and the dSYMs folder downloaded from iTunes Connect):</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>xcrun dsymutil -symbol-map ~/Library/Developer/Xcode/Archives/2017-11-23/MyGreatApp\ 11-23-17\,\ 12.00\ PM.xcarchive/BCSymbolMaps ~/Downloads/dSYMs/3B15C133-88AA-35B0-B8BA-84AF76826CE0.dSYM
</code></pre></div></div>

<h2 id="symbolicating-ios-crash-reports-with-xcode">Symbolicating iOS Crash Reports with Xcode</h2>
<p>Xcode will automatically attempt to symbolicate all crash reports.
All you need to do for symbolication is to add the crash report to the Xcode Organizer.</p>
<ul>
  <li>Note: Xcode will not accept crash reports without a <code class="highlighter-rouge">.crash</code> extension. If you have received a crash report without an extension, or with a <code class="highlighter-rouge">.txt</code> extension, rename it to have a <code class="highlighter-rouge">.crash</code> extension before following the steps listed below.</li>
</ul>

<p>Follow the steps:</p>
<ol>
  <li>Connect an iOS device to your Mac</li>
  <li>Choose “Devices” from the “Window” menu</li>
  <li>Under the “DEVICES” section in the left column, choose a device</li>
  <li>Click the “View Device Logs” button under the “Device Information” section on the right hand panel</li>
  <li>Drag your crash report onto the left column of the presented panel</li>
  <li>Xcode will automatically symbolicate the crash report and display the results</li>
</ol>

<h2 id="symbolicating-crash-reports-with-atos">Symbolicating Crash Reports With atos</h2>
<p><code class="highlighter-rouge">atos</code> command can be used to symbolicate individual addresses in the backtrace
of an unsymbolicatd, or partially symbolicatd, crash report.</p>

<p>Steps:</p>
<ol>
  <li>Find a line in the backtrace which you want to symbolicate. Note the name of the binary image in the second column, and the address in the third column.</li>
  <li>Look for a binary image with that name in the list of binary images at the bottom of the crash report. Note the architecture and load address of the binary image.
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>atos -arch &lt;Binary Architecture&gt; -o &lt;Path to dSYM file&gt;/Contents/Resources/DWARF/&lt;binary image name&gt; -l &lt;load address&gt; &lt;address to symbolicate&gt;
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="symbolication-troubleshooting">Symbolication Troubleshooting</h2>
<p>If Xcode is failing to fully symbolicate a crash report, it’s likely because your
Mac is missing the dSYM file for the application binary, the dSYM files for one
or more frameworks the application links against, or the device symbols for the
OS the application was running on when it crashed.</p>

<p>Steps:</p>
<ol>
  <li>Find a line in the backtrace which Xcode failed to symbolicate. Note the name of the binary image in the second column.</li>
  <li>Look for a binary image with that name in the list of binary images at the bottom of the crash report. This list contains the UUIDs for each of the binary images that were loaded into the process at the time of the crash.
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ grep --after-context=1000 "Binary Images:" &lt;Path to Crash Report&gt; | grep &lt;Binary Name&gt;
</code></pre></div>    </div>
  </li>
  <li>Convert the UUID of the binary image to a 32 character string seperated in groups of 8-4-4-4-12 (XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX). Note that all letters must be uppercased.</li>
  <li>Search for the UUID using the mdfind command line tool using the query “com_apple_xcode_dsym_uuids == <UUID>" (include the quotation marks).
</UUID>    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ mdfind "com_apple_xcode_dsym_uuids == &lt;UUID&gt;"
</code></pre></div>    </div>
  </li>
  <li>If Spotlight finds a dSYM file for the UUID, mdfind will print the path to the dSYM file and possibly its containing archive. If a dSYM file for the UUID was not found, mdfind will exit without printing anything.</li>
</ol>

<p>If you think that you have the correct dSYM for the binary image, you can use the dwarfdump command to print the matching UUIDs. You can also use the dwarfdump command to print the UUIDs of a binary.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>xcrun dwarfdump --uuid &lt;Path to dSYM file&gt;
</code></pre></div></div>

<h1 id="analyzing-crash-reports">Analyzing Crash Reports</h1>

<h2 id="getting-crash-logs">Getting Crash Logs</h2>

<p><a href="https://developer.apple.com/library/archive/qa/qa1747/_index.html">Debugging Deployed iOS Apps</a></p>

<h3 id="getting-crash-logs-directly-from-a-device-without-xcode">Getting Crash Logs Directly From a Device Without Xcode</h3>
<p>(It is not possible to get device console logs directly from a device)</p>

<ol>
  <li>Open Settings app</li>
  <li>Go to Privacy, then Diagnostics &amp; Usage</li>
  <li>Select Diagnostics &amp; Usage Data</li>
  <li>Locate the log for the crashed app. The logs will be named in the format: <AppName>_<DateTime>_<DeviceName></DeviceName></DateTime></AppName></li>
  <li>Select the desired log. Then, using the text selection UI select the entire text of the log. Once the text is selected, tap Copy</li>
  <li>Paste the copied text to Mail and send to an email address as desired</li>
</ol>

<h3 id="getting-crash-logs-and-console-output-from-a-device-using-xcode">Getting Crash Logs and Console Output From a Device Using Xcode</h3>
<p>(Even though you won’t be able to run the app in Xcode’s debugger, Xcode can still give you all the information you need to debug the problem.)</p>

<ol>
  <li>Plug in the device and open Xcode</li>
  <li>Choose Window -&gt; Devices from the menu bar</li>
  <li>Under the DEVICES section in the left column, choose the device</li>
  <li>To see the device console, click the up-triangle at the bottom left of the right hand panel</li>
  <li>Click the down arrow on the bottom right to save the console as a file</li>
  <li>To see crash logs, select the View Device Logs button under the Device Information section on the right hand panel</li>
  <li>Find your app in the Process column and select the Crash log to see the contents.</li>
  <li>To save a crash log, right click the entry on the left column and choose “Export Log”</li>
  <li>Xcode 6 will also list low memory logs here. These will be shown with a Process name “Unknown” and Type “Unknown”. You should examine the contents of these logs to determine whether any of these are caused by your app. For more information about low memory logs, see Understanding and Analyzing iOS Application Crash Reports.</li>
</ol>

<h4 id="reference">Reference</h4>
<p><a href="https://developer.apple.com/library/archive/technotes/tn2151/_index.html">Technical Note TN2151: Understanding and Analyzing Application Crash Reports</a></p>

  </div>
  <div class="colophon">
    <p>
      <span id="pub-date">Published on 14 May 2019</span> <span class="separator">&bull;</span>
      <span id="social">Find me on <a href="">Twitter</a>!</span>
    </p>
  </div>

  <!-- Add Disqus comments. -->
  <div id="disqus_thread"></div>
  <script src="/scripts/disqus.js" type="text/javascript"></script>
  <script id="dsq-count-scr" src="//hevawu-github-io.disqus.com/count.js" async></script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</div>


  </div>
  <script src="/scripts/responsive.js" type="text/javascript"></script>
</body>

</html>