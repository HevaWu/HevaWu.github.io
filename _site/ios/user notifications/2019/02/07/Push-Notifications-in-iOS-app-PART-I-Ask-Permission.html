<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Heva Wu's Blog - Push Local Notifications in iOS app - PART I Ask Permission</title>
  <meta name="viewport" content="width=device-width">

  <!-- syntax highlighting CSS -->
  <link rel="stylesheet" href="/css/syntax.css">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/css/main.css">

  <!-- Responsive CSS -->
  <link rel="stylesheet" href="/css/responsive.css">

  <!-- Google Fonts -->
  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Raleway:300,400,700' rel='stylesheet' type='text/css'>
</head>

<body>
  <div class="site">
    <div class="sidebar" id="sidebar">
      <div class="header">
        <h1 class="title"><a href="/"><img id="logo" src="/images/logo.png"></a></h1>
        <span class="tagline">Heva Wu's Blog</span>
        <span class="motto">I may not be there yet, but I'm closer than I was yesterday. </span>
        <span class="motto">(￣︶￣)↗[GO!]</span>
      </div>
      <div class="posts">
        <ul class="posts-list">
          
          <li class="post-link">
            <a class="post-title" href="/ios/user%20notifications/2019/02/07/Push-Notifications-in-iOS-app-PART-I-Ask-Permission.html">
              <span class="post-date">07 Feb 2019</span>
              Push Local Notifications in iOS app - PART I Ask Permission
            </a>
          </li>
          
          <li class="post-link">
            <a class="post-title" href="/test/2019/01/06/test-post.html">
              <span class="post-date">06 Jan 2019</span>
              Test post
            </a>
          </li>
          
        </ul>
      </div>
      <div class="tags">
          <h4 class="page-heading">
            <!-- Tags: -->
          </h4>
      </div>
      <div class="footer">
        <span id="footer-links">
          <a href="" class="footer-link">About</a> <span class="separator">•</span>
          <a href="https://www.linkedin.com/in/he-heva-wu-2a6819113/" class="footer-link">LinkedIn</a> <span class="separator">•</span>
          <a href="https://github.com/HevaWu" class="footer-link">GitHub</a>
        </span>
      </div>
    </div>

    <div class="content" id="home">
  <div id="sidebar-button">
    <img src="/images/sidebar-button.png">
  </div>
  <div id="post-info">
    <div id="cover-photo-container">
      
    </div>
    <div id="info-container">
      <h1 id="title">Push Local Notifications in iOS app - PART I Ask Permission</h1>
      <time datetime="2019-02-07T01:34:00+09:00" itemprop="datePublished">
        Feb 7, 2019
      </time>
      
    </div>
  </div>

  <div class="post">
    <p>This article only discuss about the <code class="highlighter-rouge">Asking Permission part for Local Notifications</code>. I will discuss the remain part &amp; <code class="highlighter-rouge">Remote Notifications</code> part in the future article.</p>

<p>Here is the guide link from Apple document, if you have time, I would suggest to read it <img class="emoji" title=":blush:" alt=":blush:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f60a.png" height="20" width="20"></p>
<ul>
  <li>User Notifications: https://developer.apple.com/documentation/usernotifications</li>
  <li>User Notifications - Asking permission to use notifications: https://developer.apple.com/documentation/usernotifications/asking_permission_to_use_notifications</li>
</ul>

<p>Come back to the topic. I want to show you how it would work.</p>

<h2 id="request-authorization">Request Authorization</h2>

<p>About pushing notifications, whether the local notifications or the remote notifications. Of course the first thing we need to do is to request user’s authorization to show the notification messags.</p>

<p>The code is super simple:</p>
<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">center</span> <span class="o">=</span> <span class="kt">UNUserNotificationCenter</span><span class="o">.</span><span class="nf">current</span><span class="p">()</span>
<span class="c1">// Request permission to display alerts and play sounds.</span>
<span class="n">center</span><span class="o">.</span><span class="nf">requestAuthorization</span><span class="p">(</span><span class="nv">options</span><span class="p">:</span> <span class="p">[</span><span class="o">.</span><span class="n">alert</span><span class="p">,</span> <span class="o">.</span><span class="n">sound</span><span class="p">])</span> <span class="p">{</span> <span class="p">(</span><span class="n">granted</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
    <span class="c1">// Enable or disable features based on authorization.</span>
    <span class="k">if</span> <span class="n">granted</span><span class="p">,</span> <span class="n">error</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="o">...</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="o">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Just add this code where you want to request the authorization. Most of the time, we make the authorization reqeust when we launch the app. Depends on your app, you could also ask the permission in some customized Permission UI and trigger it by clicking the buttons.</p>

<p>But, there is one thing you need to pay attention is:
in iOS app, we will only show this default notification permission dialog <code class="highlighter-rouge">1</code> time.</p>

<p><img class="emoji" title=":arrow_up:" alt=":arrow_up:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/2b06.png" height="20" width="20"> This means user will only have 1 chance to use this default dialog to set their promotion about pushing notifications.</p>

<p>Sometimes, people ask, if I want to show this dialog again, and make user to change their options, what should I do? Well, in this case, I have to say, maybe you could give a custom permision page for this part, and with a trigger button for requesting setting notifications. Once user click it, you could just redirect your app to <code class="highlighter-rouge">Apple Default Settings</code> page, and let user to change switch on or off for showing your app notifications. OR, there is a simple way, you just give them a dialog, and tell them, you should set/change your notification settings in the Apple Default Settings part. It is so easy, right?</p>

<h2 id="check-current-settings">Check Current Settings</h2>

<p>After user click <code class="highlighter-rouge">Allow</code> or <code class="highlighter-rouge">Not Allow</code>, apple help us to store this value. And we could directly retrieve it.</p>

<p>Before we starting scheduling the notifications, we should check if current settings status. And schedule the corresponding notifications.</p>

<p>Here is the example code:</p>
<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">notificationCenter</span> <span class="o">=</span> <span class="kt">UNUserNotificationCenter</span><span class="o">.</span><span class="nf">current</span><span class="p">()</span>
<span class="n">notificationCenter</span><span class="o">.</span><span class="n">getNotificationSettings</span> <span class="p">{</span> <span class="p">(</span><span class="n">settings</span><span class="p">)</span> <span class="k">in</span>
   <span class="c1">// Do not schedule notifications if not authorized.</span>
   <span class="k">guard</span> <span class="n">settings</span><span class="o">.</span><span class="n">authorizationStatus</span> <span class="o">==</span> <span class="o">.</span><span class="n">authorized</span> <span class="k">else</span> <span class="p">{</span><span class="k">return</span><span class="p">}</span>

   <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">alertSetting</span> <span class="o">==</span> <span class="o">.</span><span class="n">enabled</span> <span class="p">{</span>
      <span class="c1">// Schedule an alert-only notification.</span>
	   <span class="k">self</span><span class="o">.</span><span class="nf">myScheduleAlertNotification</span><span class="p">()</span>
   <span class="p">}</span>
   <span class="k">else</span> <span class="p">{</span>
      <span class="c1">// Schedule a notification with a badge and sound.</span>
      <span class="k">self</span><span class="o">.</span><span class="nf">badgeAppAndPlaySound</span><span class="p">()</span>
   <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This is the begining of pushing notifications. Just 3 minutes is enough for setting this. <img class="emoji" title=":tada:" alt=":tada:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f389.png" height="20" width="20"></p>

<p>Next I will introduce how to scheduling local notifications, let’s try to push our own notifications together. <img class="emoji" title=":tada:" alt=":tada:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f389.png" height="20" width="20"></p>

  </div>
  <div class="colophon">
    <p>
      <span id="pub-date">Published on 07 Feb 2019</span> <span class="separator">•</span>
      <span id="social">Find me on <a href="">Twitter</a>!</span>
    </p>
  </div>

  <!-- Add Disqus comments. -->
  <div id="disqus_thread"></div>
  <script src="/scripts/disqus.js" type="text/javascript"></script>
  <script id="dsq-count-scr" src="//hevawu-github-io.disqus.com/count.js" async></script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</div>


  </div>
  <script src="/scripts/responsive.js" type="text/javascript"></script>
</body>

</html>